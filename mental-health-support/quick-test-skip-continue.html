<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skip & Continue Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
    </style>
</head>
<body>
    <h1>üß™ Skip & Continue Test</h1>
    
    <div class="test-section">
        <h2>Current Status</h2>
        <div id="status"></div>
        <button onclick="refreshStatus()">Refresh Status</button>
    </div>

    <div class="test-section">
        <h2>Test Skip Functions</h2>
        <button onclick="testSkipSingle()">Skip Single Assessment (PHQ-9)</button>
        <button onclick="testSkipAll()">Skip All Assessments</button>
        <button onclick="testComplete()">Complete Assessment</button>
    </div>

    <div class="test-section">
        <h2>Test Redirect Logic</h2>
        <button onclick="testRedirectLogic()">Test Should Redirect</button>
        <div id="redirectResult"></div>
    </div>

    <div class="test-section">
        <h2>Reset</h2>
        <button onclick="clearAll()" style="background: #dc3545;">Clear All Data</button>
    </div>

    <script>
        function refreshStatus() {
            const assessments = JSON.parse(localStorage.getItem('user_assessments') || '{}');
            let html = '<h3>localStorage Data:</h3><pre>' + JSON.stringify(assessments, null, 2) + '</pre>';
            
            const phq9Status = assessments.phq9 ? 
                (assessments.phq9.skipped ? 'SKIPPED' : assessments.phq9.completed ? 'COMPLETED' : 'INCOMPLETE') : 'MISSING';
            const gad7Status = assessments.gad7 ? 
                (assessments.gad7.skipped ? 'SKIPPED' : assessments.gad7.completed ? 'COMPLETED' : 'INCOMPLETE') : 'MISSING';
            
            html += '<div class="info"><strong>PHQ-9:</strong> ' + phq9Status + '</div>';
            html += '<div class="info"><strong>GAD-7:</strong> ' + gad7Status + '</div>';
            
            document.getElementById('status').innerHTML = html;
        }

        function testSkipSingle() {
            const assessments = JSON.parse(localStorage.getItem('user_assessments') || '{}');
            assessments.phq9 = {
                assessmentType: 'phq9',
                skipped: true,
                completed: true,
                skippedAt: new Date().toISOString()
            };
            localStorage.setItem('user_assessments', JSON.stringify(assessments));
            refreshStatus();
            alert('‚úÖ Single assessment (PHQ-9) marked as skipped');
        }

        function testSkipAll() {
            const skipAll = {
                phq9: {
                    assessmentType: 'phq9',
                    skipped: true,
                    completed: true,
                    skippedAt: new Date().toISOString()
                },
                gad7: {
                    assessmentType: 'gad7',
                    skipped: true,
                    completed: true,
                    skippedAt: new Date().toISOString()
                }
            };
            localStorage.setItem('user_assessments', JSON.stringify(skipAll));
            refreshStatus();
            alert('‚úÖ All assessments marked as skipped');
        }

        function testComplete() {
            const complete = {
                phq9: {
                    assessmentType: 'phq9',
                    score: 5,
                    classification: { severity: 'Mild', description: 'Mild depression' },
                    answers: { 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 0, 7: 0, 8: 0, 9: 0 },
                    completed: true,
                    completedAt: new Date().toISOString()
                },
                gad7: {
                    assessmentType: 'gad7',
                    score: 3,
                    classification: { severity: 'Minimal', description: 'Minimal anxiety' },
                    answers: { 1: 1, 2: 1, 3: 1, 4: 0, 5: 0, 6: 0, 7: 0 },
                    completed: true,
                    completedAt: new Date().toISOString()
                }
            };
            localStorage.setItem('user_assessments', JSON.stringify(complete));
            refreshStatus();
            alert('‚úÖ All assessments marked as completed');
        }

        function testRedirectLogic() {
            const savedAssessments = JSON.parse(localStorage.getItem('user_assessments') || '{}');
            
            // Test the NEW logic
            const phq9Complete = savedAssessments.phq9 && 
                (savedAssessments.phq9.completed === true || savedAssessments.phq9.skipped === true);
            const gad7Complete = savedAssessments.gad7 && 
                (savedAssessments.gad7.completed === true || savedAssessments.gad7.skipped === true);
            const allAssessmentsHandled = phq9Complete && gad7Complete;
            
            const shouldRedirect = !allAssessmentsHandled;
            
            let resultClass = shouldRedirect ? 'error' : 'success';
            let resultText = shouldRedirect ? '‚ùå WILL REDIRECT' : '‚úÖ NO REDIRECT';
            
            document.getElementById('redirectResult').innerHTML = `
                <div class="${resultClass}">
                    <strong>${resultText}</strong><br>
                    PHQ-9 Handled: ${phq9Complete}<br>
                    GAD-7 Handled: ${gad7Complete}<br>
                    All Handled: ${allAssessmentsHandled}
                </div>
            `;
        }

        function clearAll() {
            localStorage.removeItem('user_assessments');
            refreshStatus();
            document.getElementById('redirectResult').innerHTML = '';
            alert('üóëÔ∏è All data cleared');
        }

        // Initialize
        refreshStatus();
    </script>
</body>
</html>